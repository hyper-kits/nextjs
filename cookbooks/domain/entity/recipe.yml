name: entity
description: |
  Generate a domain entity with ORM schema, Zod validation, and TypeScript types.

  Generates:
  - Zod validation schema with create/update variants and inferred types
  - Drizzle table definition (when ORM is Drizzle)
  - Prisma model injection (when ORM is Prisma)
  - Schema barrel export (when ORM is Drizzle)

  Time saved: 20-40 min → 2 min

version: 1.0.0

variables:
  name:
    type: string
    description: Entity name (singular, camelCase — e.g., 'user', 'organization', 'todoItem')
    required: true
    position: 0
    prompt: What is the entity name? (singular, e.g., 'user', 'organization')

  fields:
    type: string
    description: Comma-separated fields with types (e.g., "name:string,email:string,role:enum")
    required: false
    prompt: What properties does the entity have?

  relations:
    type: string
    description: Comma-separated relations (e.g., "belongsTo:organization,hasMany:todos")
    required: false
    prompt: |
      Does the entity have any relationships?

  withRepository:
    type: boolean
    description: Set to `true` to also generate a repository interface and ORM implementation
    default: false
    prompt: |
      Do you want to also generate a Repository for this entity?

onSuccess: |
  Entity '{{ name }}' generated successfully!

  Generated files:
    lib/schemas/{{ name }}-schema.ts -- Zod validation + types
  @if(detectedOrm === 'drizzle')
    db/schema/{{ name }}.ts -- Drizzle table definition
    db/schema/index.ts -- Updated barrel export
  @elseif(detectedOrm === 'prisma')
    prisma/schema.prisma -- Prisma model (injected)
  @end
  @if(withRepository)
    lib/domain/repositories/{{ name }}-repository.ts -- Repository interface
  @if(detectedOrm !== 'none')
    lib/infrastructure/repositories/{{ name }}-repository.impl.ts -- {{ detectedOrm }} implementation
  @end
  @end

  Next steps:
    1. Review the generated schema
    2. Run migrations (drizzle-kit push / prisma db push)
  @if(!withRepository)
    3. Use 'hypergen nextjs domain repository {{ name }}' to add a repository
  @end

steps:
  - name: Check for Drizzle ORM
    tool: query
    file: package.json
    checks:
      - path: dependencies.drizzle-orm
        exportExists: hasDrizzle

  - name: Check for Prisma Client
    tool: query
    file: package.json
    checks:
      - path: dependencies.@prisma/client
        exportExists: hasPrisma

  - name: Resolve ORM
    tool: shell
    command: |
      @if(hasDrizzle)
        echo "drizzle"
      @elseif(hasPrisma)
        echo "prisma"
      @else
        echo "none"
      @end
    exports:
      detectedOrm: '{{ result.stdout.trim() }}'

  - name: Generate Zod validation schema
    tool: template
    template: templates/zod-schema.ts.jig

  - name: Generate Drizzle table definition
    tool: template
    template: templates/drizzle-schema.ts.jig
    when: "detectedOrm === 'drizzle'"

  - name: Generate Prisma model
    tool: template
    template: templates/prisma-schema.prisma.jig
    when: "detectedOrm === 'prisma'"

  - name: Update schema barrel export
    tool: template
    template: templates/schema-index.ts.jig
    when: "detectedOrm === 'drizzle'"

  - name: Generate repository
    tool: recipe
    recipe: ../../repository
    when: 'withRepository === true'
    args:
      name: '{{ name }}'
